# ğŸ—ï¸ SlotSwapper Architecture

## System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Browser                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚            React Frontend (Port 3000)               â”‚    â”‚
â”‚  â”‚                                                      â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚    â”‚
â”‚  â”‚  â”‚  Pages   â”‚  â”‚ Context  â”‚  â”‚  Components  â”‚     â”‚    â”‚
â”‚  â”‚  â”‚          â”‚  â”‚  (Auth)  â”‚  â”‚              â”‚     â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚    â”‚
â”‚  â”‚                                                      â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚        API Client (Axios)                    â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ HTTP/REST
                           â”‚ (JWT Bearer Token)
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Express Backend (Port 5000)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                   Middleware                        â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚    â”‚
â”‚  â”‚  â”‚   CORS   â”‚  â”‚   Auth   â”‚  â”‚    Error     â”‚     â”‚    â”‚
â”‚  â”‚  â”‚          â”‚  â”‚ (JWT)    â”‚  â”‚   Handler    â”‚     â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                     Routes                          â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚    â”‚
â”‚  â”‚  â”‚   Auth   â”‚  â”‚  Events  â”‚  â”‚    Swaps     â”‚     â”‚    â”‚
â”‚  â”‚  â”‚ /signup  â”‚  â”‚  CRUD    â”‚  â”‚  /swappable  â”‚     â”‚    â”‚
â”‚  â”‚  â”‚  /login  â”‚  â”‚          â”‚  â”‚  /swap-req   â”‚     â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              Prisma ORM Client                      â”‚    â”‚
â”‚  â”‚         (Type-safe Database Access)                 â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ SQL Queries
                           â”‚ (Connection Pool)
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            PostgreSQL Database (Port 5432)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                     Tables                          â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚    â”‚
â”‚  â”‚  â”‚   User   â”‚  â”‚  Event   â”‚  â”‚ SwapRequest  â”‚     â”‚    â”‚
â”‚  â”‚  â”‚          â”‚  â”‚          â”‚  â”‚              â”‚     â”‚    â”‚
â”‚  â”‚  â”‚  - id    â”‚  â”‚  - id    â”‚  â”‚  - id        â”‚     â”‚    â”‚
â”‚  â”‚  â”‚  - email â”‚  â”‚  - title â”‚  â”‚  - initiator â”‚     â”‚    â”‚
â”‚  â”‚  â”‚  - name  â”‚  â”‚  - start â”‚  â”‚  - receiver  â”‚     â”‚    â”‚
â”‚  â”‚  â”‚  - pass  â”‚  â”‚  - end   â”‚  â”‚  - slots     â”‚     â”‚    â”‚
â”‚  â”‚  â”‚          â”‚  â”‚  - statusâ”‚  â”‚  - status    â”‚     â”‚    â”‚
â”‚  â”‚  â”‚          â”‚  â”‚  - userIdâ”‚  â”‚              â”‚     â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚    â”‚
â”‚  â”‚       â”‚             â”‚  â”‚            â”‚    â”‚          â”‚    â”‚
â”‚  â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚          â”‚    â”‚
â”‚  â”‚         (Foreign Keys)                    â”‚          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow

### 1. Authentication Flow

```
User â†’ Login Form â†’ POST /api/auth/login
                         â†“
                    Validate Credentials
                         â†“
                    bcrypt.compare()
                         â†“
                    Generate JWT
                         â†“
                    Return Token + User
                         â†“
User â† Store in localStorage
```

### 2. Create Event Flow

```
User â†’ Dashboard â†’ Create Event Modal
                         â†“
                    Fill Form Data
                         â†“
                POST /api/events
          (with JWT Bearer Token)
                         â†“
                 Validate Token
                         â†“
              Validate Event Data
                         â†“
             prisma.event.create()
                         â†“
              Insert into Database
                         â†“
User â† Event Created â† Return Event Object
```

### 3. Swap Request Flow (Complex!)

```
User A                  Server                    User B
  â”‚                       â”‚                         â”‚
  â”‚  Mark slot SWAPPABLE  â”‚                         â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                         â”‚
  â”‚                       â”‚                         â”‚
  â”‚                       â”‚  Mark slot SWAPPABLE    â”‚
  â”‚                       â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                       â”‚                         â”‚
  â”‚  Browse Marketplace   â”‚                         â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                         â”‚
  â”‚<â”€ See B's Slot â”€â”€â”€â”€â”€â”€â”€â”¤                         â”‚
  â”‚                       â”‚                         â”‚
  â”‚  Request Swap         â”‚                         â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                         â”‚
  â”‚                       â”‚                         â”‚
  â”‚                    BEGIN TRANSACTION            â”‚
  â”‚                       â”‚                         â”‚
  â”‚                  Set Both Slots                 â”‚
  â”‚                  to SWAP_PENDING                â”‚
  â”‚                       â”‚                         â”‚
  â”‚                  Create SwapRequest             â”‚
  â”‚                    (status: PENDING)            â”‚
  â”‚                       â”‚                         â”‚
  â”‚                    COMMIT                       â”‚
  â”‚                       â”‚                         â”‚
  â”‚<â”€ Request Created â”€â”€â”€â”€â”¤                         â”‚
  â”‚                       â”‚                         â”‚
  â”‚                       â”‚   Poll for Requests     â”‚
  â”‚                       â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                       â”‚â”€â”€ Incoming Request â”€â”€â”€â”€>â”‚
  â”‚                       â”‚                         â”‚
  â”‚                       â”‚   Accept Swap           â”‚
  â”‚                       â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                       â”‚                         â”‚
  â”‚                    BEGIN TRANSACTION            â”‚
  â”‚                       â”‚                         â”‚
  â”‚                 Update SwapRequest              â”‚
  â”‚                  (status: ACCEPTED)             â”‚
  â”‚                       â”‚                         â”‚
  â”‚              Exchange Slot Ownership:           â”‚
  â”‚                A's slot â†’ B                     â”‚
  â”‚                B's slot â†’ A                     â”‚
  â”‚                       â”‚                         â”‚
  â”‚                Set Both Slots                   â”‚
  â”‚                  to BUSY                        â”‚
  â”‚                       â”‚                         â”‚
  â”‚                    COMMIT                       â”‚
  â”‚                       â”‚                         â”‚
  â”‚<â”€ A now has B's slot â”€â”¤â”€â”€ B now has A's slot â”€â”€>â”‚
  â”‚                       â”‚                         â”‚
```

### 4. Swap Rejection Flow

```
User B                  Server                    User A
  â”‚                       â”‚                         â”‚
  â”‚  Reject Swap          â”‚                         â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                         â”‚
  â”‚                       â”‚                         â”‚
  â”‚                    BEGIN TRANSACTION            â”‚
  â”‚                       â”‚                         â”‚
  â”‚                 Update SwapRequest              â”‚
  â”‚                  (status: REJECTED)             â”‚
  â”‚                       â”‚                         â”‚
  â”‚                Set Both Slots                   â”‚
  â”‚                  to SWAPPABLE                   â”‚
  â”‚                       â”‚                         â”‚
  â”‚                    COMMIT                       â”‚
  â”‚                       â”‚                         â”‚
  â”‚<â”€ Swap Rejected â”€â”€â”€â”€â”€â”€â”¤â”€â”€ Slots Available â”€â”€â”€â”€â”€>â”‚
  â”‚                       â”‚                         â”‚
```

## Component Hierarchy

### Frontend Structure

```
App.tsx
â”œâ”€â”€ AuthProvider (Context)
â”‚   â””â”€â”€ BrowserRouter
â”‚       â””â”€â”€ Routes
â”‚           â”œâ”€â”€ Login
â”‚           â”œâ”€â”€ Signup
â”‚           â””â”€â”€ ProtectedRoute
â”‚               â”œâ”€â”€ Dashboard
â”‚               â”‚   â”œâ”€â”€ EventsList
â”‚               â”‚   â””â”€â”€ CreateEventModal
â”‚               â”œâ”€â”€ Marketplace
â”‚               â”‚   â”œâ”€â”€ SlotsList
â”‚               â”‚   â””â”€â”€ SwapRequestModal
â”‚               â””â”€â”€ Requests
â”‚                   â”œâ”€â”€ IncomingRequests
â”‚                   â””â”€â”€ OutgoingRequests
```

### Backend Structure

```
server.ts
â”œâ”€â”€ Middleware
â”‚   â”œâ”€â”€ cors()
â”‚   â”œâ”€â”€ express.json()
â”‚   â””â”€â”€ errorHandler
â”œâ”€â”€ Routes
â”‚   â”œâ”€â”€ /api/auth
â”‚   â”‚   â”œâ”€â”€ POST /signup
â”‚   â”‚   â””â”€â”€ POST /login
â”‚   â”œâ”€â”€ /api/events (authenticate)
â”‚   â”‚   â”œâ”€â”€ GET    /
â”‚   â”‚   â”œâ”€â”€ GET    /:id
â”‚   â”‚   â”œâ”€â”€ POST   /
â”‚   â”‚   â”œâ”€â”€ PATCH  /:id
â”‚   â”‚   â””â”€â”€ DELETE /:id
â”‚   â””â”€â”€ /api (authenticate)
â”‚       â”œâ”€â”€ GET  /swappable-slots
â”‚       â”œâ”€â”€ GET  /swap-requests
â”‚       â”œâ”€â”€ POST /swap-request
â”‚       â””â”€â”€ POST /swap-response/:id
â””â”€â”€ Error Handler
```

## Database Schema (ERD)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        User         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)             â”‚
â”‚ email (UNIQUE)      â”‚
â”‚ name                â”‚
â”‚ password            â”‚
â”‚ createdAt           â”‚
â”‚ updatedAt           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ 1
         â”‚
         â”‚ N
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       Event         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)             â”‚
â”‚ title               â”‚
â”‚ startTime           â”‚
â”‚ endTime             â”‚
â”‚ status (ENUM)       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”
â”‚ userId (FK)         â”‚        â”‚
â”‚ createdAt           â”‚        â”‚
â”‚ updatedAt           â”‚        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
         â”‚                     â”‚
         â”‚                     â”‚
         â”‚ N                   â”‚
         â”‚                     â”‚
         â”‚                     â”‚
         â–¼                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚    SwapRequest      â”‚        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”‚
â”‚ id (PK)             â”‚        â”‚
â”‚ initiatorId (FK)    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â–º User
â”‚ receiverId (FK)     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ initiatorSlotId(FK) â”‚â”€â”€â”€â”€â–º Event
â”‚ receiverSlotId (FK) â”‚â”€â”€â”€â”€â–º Event
â”‚ status (ENUM)       â”‚
â”‚ createdAt           â”‚
â”‚ updatedAt           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Enums:
- EventStatus: BUSY, SWAPPABLE, SWAP_PENDING
- SwapRequestStatus: PENDING, ACCEPTED, REJECTED
```

## State Management

### Frontend State

```
AuthContext (Global)
â”œâ”€â”€ user: User | null
â”œâ”€â”€ token: string | null
â”œâ”€â”€ login(email, password)
â”œâ”€â”€ signup(email, name, password)
â”œâ”€â”€ logout()
â””â”€â”€ isAuthenticated: boolean

Component State (Local)
â”œâ”€â”€ Dashboard
â”‚   â”œâ”€â”€ events: Event[]
â”‚   â”œâ”€â”€ loading: boolean
â”‚   â”œâ”€â”€ showModal: boolean
â”‚   â””â”€â”€ form data
â”œâ”€â”€ Marketplace
â”‚   â”œâ”€â”€ slots: Event[]
â”‚   â”œâ”€â”€ mySwappableSlots: Event[]
â”‚   â”œâ”€â”€ selectedSlot: Event | null
â”‚   â””â”€â”€ showModal: boolean
â””â”€â”€ Requests
    â”œâ”€â”€ incoming: SwapRequest[]
    â”œâ”€â”€ outgoing: SwapRequest[]
    â””â”€â”€ auto-refresh interval
```

## Security Layers

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Frontend                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Protected Routes                 â”‚  â”‚
â”‚  â”‚  (Redirect if no token)           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                 â†“                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  JWT Token in localStorage        â”‚  â”‚
â”‚  â”‚  (Sent with every API call)       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
         HTTP Headers
         Authorization: Bearer <token>
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Backend                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Auth Middleware                  â”‚  â”‚
â”‚  â”‚  - Verify JWT                     â”‚  â”‚
â”‚  â”‚  - Extract userId                 â”‚  â”‚
â”‚  â”‚  - Attach to request              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                 â†“                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Authorization Checks             â”‚  â”‚
â”‚  â”‚  - Verify ownership               â”‚  â”‚
â”‚  â”‚  - Validate permissions           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                 â†“                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Input Validation                 â”‚  â”‚
â”‚  â”‚  - express-validator              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                 â†“                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Prisma ORM                       â”‚  â”‚
â”‚  â”‚  - Parameterized queries          â”‚  â”‚
â”‚  â”‚  - SQL injection protection       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Transaction Example (Swap Accept)

```sql
BEGIN TRANSACTION;

-- 1. Update swap request
UPDATE "SwapRequest"
SET status = 'ACCEPTED'
WHERE id = '<requestId>';

-- 2. Exchange ownership (A's slot goes to B)
UPDATE "Event"
SET userId = '<userB_id>',
    status = 'BUSY'
WHERE id = '<slotA_id>';

-- 3. Exchange ownership (B's slot goes to A)
UPDATE "Event"
SET userId = '<userA_id>',
    status = 'BUSY'
WHERE id = '<slotB_id>';

COMMIT;
-- All or nothing - ensures data integrity!
```

## API Response Format

### Success Response
```json
{
  "success": true,
  "data": { /* ... */ }
}
```

### Error Response
```json
{
  "success": false,
  "error": "Error message",
  "stack": "..." // Only in development
}
```

## Environment Configuration

```
Development:
- Frontend: localhost:3000 (Vite dev server)
- Backend: localhost:5000 (ts-node-dev)
- Database: localhost:5432 (PostgreSQL)

Docker:
- Frontend: port 3000 (mapped to host)
- Backend: port 5000 (mapped to host)
- Database: port 5432 (internal network)
- Volumes for hot-reload

Production (Suggested):
- Frontend: Vercel/Netlify (static hosting)
- Backend: Render/Railway (Node.js hosting)
- Database: Neon/Supabase (managed PostgreSQL)
```

## Performance Considerations

1. **Database Indexes**
   - userId on Event table
   - status on Event table
   - initiatorId, receiverId on SwapRequest

2. **Query Optimization**
   - Use `select` to limit returned fields
   - Use `include` for necessary relations only
   - Paginate large result sets (future)

3. **Frontend Optimization**
   - React.memo for expensive components
   - Lazy loading for routes (future)
   - Debounce search inputs (future)

4. **Caching Strategy** (Future)
   - Redis for session storage
   - Cache swappable slots list
   - Invalidate on status changes

---

This architecture is designed to be:
- âœ… **Scalable**: Can handle growth in users and data
- âœ… **Secure**: Multiple security layers
- âœ… **Maintainable**: Clear separation of concerns
- âœ… **Testable**: Each layer can be tested independently
- âœ… **Type-safe**: TypeScript throughout
